# Q1 可视化规划文档：粉丝投票反推与不确定性量化

**目标**: 通过可视化展示Q1的核心贡献——从淘汰结果反推粉丝投票分布，并量化推断的不确定性

## 📊 **核心可视化目标**

### 1. **证明方法有效性**: 展示贝叶斯推断能够从有限约束中恢复合理的粉丝投票分布
### 2. **量化不确定性**: 可视化哪些情况下推断更可靠，哪些情况下存在较大不确定性
### 3. **对比传统方法**: 利用showcase中的机器学习方法作为对照，展示统计建模的优势
### 4. **为后续分析铺垫**: 展示技术线vs人气线的分离，为Q3/Q4提供基础

---

## ✅ 主线口径约束（写进论文正文必须遵守）

- **主线图表**只允许使用：
  - `data/processed/*.csv`
  - `outputs/tables/*.csv`
  - `outputs/predictions/*.csv`
- `outputs/tables/showcase/*` 仅用于**附录对照/炫技**，不得替代题目要求的主线论证。

---

## 🎯 **主线图表清单**

### 图1-1: 不确定性热图 (Uncertainty Heatmap)
**文件名**: `q1_uncertainty_heatmap.{tiff,eps}`

**目的**: 量化“哪些周/哪些赛季的反推更可靠”，并回答题面 Q1 的“certainty 是否一致”的要求。

**数据源**: 
- `outputs/tables/mcm2026c_q1_uncertainty_summary.csv`
- 字段: `season, week, mechanism, n_active, n_exit, ess_ratio, evidence`

**图表设计（重要口径提醒）**:

- 该表包含 `mechanism` 列（`percent` / `rank`）。
- 热图绘制时必须 **筛选单一机制**（建议正文优先展示 `percent`），或按机制分面；否则 `season-week` 单元格会混入两种机制，导致口径错误。

示意代码：

```python
# 只画 percent 机制（正文推荐）
df = data[data['mechanism'] == 'percent'].copy()

fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 10))

heatmap1 = pivot_table(df, values='ess_ratio', index='season', columns='week')
sns.heatmap(heatmap1, ax=ax1, cmap='RdYlBu_r', vmin=0, vmax=1)
ax1.set_title('ESS Ratio\n红色=高不确定性')

heatmap2 = pivot_table(df, values='evidence', index='season', columns='week')
sns.heatmap(heatmap2, ax=ax2, cmap='viridis', vmin=0, vmax=1)
ax2.set_title('Evidence\n亮色=约束信息强')
```

**关键解读点**:

- `n_exit=0` 的周往往显示为“高确定性”，但需在图注解释：这通常是“淘汰约束缺失 → 后验≈先验”的确定性，并非信息更强。
- 多淘汰/退赛/复杂周次更可能出现 `ess_ratio` 下降。

---

### 图1-2: 典型周粉丝份额后验区间图 (Fan Share Posterior Intervals)
**文件名**: `q1_fan_share_intervals.{tiff,eps}`

**目的**: 以“区间”形式展示 fan vote estimates 的不确定性，避免只给单点估计。

**数据源**:

- `outputs/predictions/mcm2026c_q1_fan_vote_posterior_summary.csv`
- 字段: `season, week, celebrity_name, mechanism, fan_share_median, fan_share_p05, fan_share_p95, eliminated_this_week`

**选择策略**:

- 选两周对比（均要求 `n_exit>0` 且 `n_active>=6`）：
  - 高不确定性：`evidence` 低（例如 <0.3）
  - 低不确定性：`evidence` 高（例如 >0.7）
- 同样需要按 `mechanism` 筛选（正文建议先展示 `percent`）。

---

### 图1-3: 技术线 vs 人气线散点图 (Judge vs Fan Preference Scatter)
**文件名**: `q1_judge_vs_fan_scatter.{tiff,eps}`

**目的**: 直观展示“技术实力≠人气实力”（为 Q3/Q4 提供动机）。

**数据源**:

- `data/processed/dwts_weekly_panel.csv`
- `outputs/predictions/mcm2026c_q1_fan_vote_posterior_summary.csv`

建议只画 `mechanism='percent'` 的点，并用 `eliminated_this_week` 高亮。

---

### 图1-4: Percent vs Rank 推断差异（同周对比）
**文件名**: `q1_mechanism_comparison.{tiff,eps}`

**目的**: 为 Q2 的 “apply both approaches to each season” 做铺垫：同一周在两种机制下的 fan share 后验是否显著不同。

**数据源**:

- `outputs/predictions/mcm2026c_q1_fan_vote_posterior_summary.csv`
- 筛选同一 `(season, week)` 下 `mechanism` 同时包含 `percent` 与 `rank` 的周。

---

## 🚀 **附录/Showcase（不进入主线）**

### 图1-5: 统计推断 vs 机器学习预测对照
**文件名**: `q1_statistical_vs_ml_comparison.{tiff,eps}`

**定位**: 附录对照。用于展示“纯预测模型”和“结构约束推断”在任务目标上的差异（注意：题面要的是 fan vote estimates + certainty，而不是淘汰分类器）。

**数据源（showcase）**:

- `outputs/tables/showcase/mcm2026c_q1_ml_elimination_baselines_cv_summary.csv`
- `outputs/tables/showcase/mcm2026c_q1_dl_elimination_transformer_summary.csv`

### 图1-6: 参数敏感性（showcase）
**文件名**: `q1_sensitivity_analysis.{tiff,eps}`

**定位**: 附录敏感性分析。

**数据源（showcase）**:

- `outputs/tables/showcase/mcm2026c_showcase_q1_sensitivity_summary.csv`

---

## 📋 **技术实现规范**

### 图片格式要求
```python
# 保存为两种高质量格式
plt.savefig('outputs/figures/q1_uncertainty_heatmap.tiff', 
           dpi=300, bbox_inches='tight', format='tiff')
plt.savefig('outputs/figures/q1_uncertainty_heatmap.eps', 
           bbox_inches='tight', format='eps')
```

### 颜色方案
- **主色调**: 蓝色系（专业、可信）
- **强调色**: 红色（淘汰、风险）、金色（最优结果）
- **对比色**: 绿色（机器学习）、橙色（传统方法）
- **确保色盲友好**: 使用ColorBrewer调色板

### 字体规范
```python
plt.rcParams.update({
    'font.size': 12,
    'axes.titlesize': 14,
    'axes.labelsize': 12,
    'xtick.labelsize': 10,
    'ytick.labelsize': 10,
    'legend.fontsize': 11,
    'font.family': 'serif'  # 学术论文标准
})
```

### 图表尺寸
- **单图**: 12×8 inches (适合论文单栏)
- **并排图**: 16×8 inches (适合论文双栏)
- **复合图**: 16×12 inches (适合整页展示)

---

## 🎯 **论文集成策略**

### 主线论证逻辑
1. **图1-1**: 开篇展示问题复杂性（不确定性分布）
2. **图1-2**: 展示方法能力（后验区间估计）
3. **图1-3**: 揭示核心发现（技术vs人气分离）
4. **图1-4**: 验证机制差异（为Q2铺垫）

### 炫技展示策略
1. **图1-5**: 证明方法选择的合理性
2. **图1-6**: 证明结果的稳健性

### 与其他题目的衔接
- **→ Q2**: 图1-4的机制差异为反事实分析提供基础
- **→ Q3**: 图1-3的技术-人气分离为影响因素分析提供动机
- **→ Q4**: 不确定性量化为新机制设计提供风险评估基础

---

## ⚠️ **注意事项与风险控制**

### 数据质量检查
- 确保所有可视化数据来源于已验证的主线产物
- 检查缺失值和异常值的处理
- 验证不同数据源之间的一致性

### 解释性说明
- 每张图都需要详细的图注解释
- 特别说明ESS Ratio和Evidence等技术指标的含义
- 明确区分"约束缺失的确定性"和"信息充分的确定性"

### 可复现性保证
- 所有图表生成代码集成到主线pipeline
- 固定随机种子确保结果一致
- 提供完整的参数配置记录

这个可视化规划确保Q1部分能够：
1. **清晰展示核心贡献**：贝叶斯推断的有效性和不确定性量化
2. **有力支撑论文论证**：为后续Q2-Q4提供坚实基础
3. **展现技术实力**：通过炫技对比证明方法选择的优越性
4. **保持学术规范**：高质量图表符合国际竞赛标准